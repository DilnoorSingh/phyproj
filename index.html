<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ISRO Mission Simulator - Fixed Trajectory</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --accent: #ff9933; --bg: #0b0d17; --panel: #1c1c2b; --rupee: #2ecc71; }
        body { margin: 0; padding: 20px; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #e0e0e0; }
        h1 { text-align: center; color: var(--accent); margin-bottom: 20px; text-transform: uppercase; }
        
        .main-layout { display: grid; grid-template-columns: 340px 1fr 350px; gap: 20px; max-width: 1450px; margin: 0 auto; }
        .panel { background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid #30363d; box-shadow: 0 8px 32px rgba(0,0,0,0.6); }
        
        .control-group { margin-bottom: 18px; }
        label { display: block; font-size: 0.85rem; color: #a3b1bc; margin-bottom: 8px; }
        input[type="range"] { width: 100%; accent-color: var(--accent); cursor: pointer; }
        
        .eco-box { background: #0d1117; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent); margin-top: 15px; }
        .eco-box p { margin: 8px 0; font-family: 'Consolas', monospace; font-size: 0.95rem; }
        .price-tag { color: var(--rupee); font-weight: bold; font-size: 1.2rem; }

        canvas#simCanvas { background: radial-gradient(circle, #1b2735 0%, #090a0f 100%); border-radius: 8px; width: 100%; height: 500px; }
        .graph-container { height: 230px; margin-bottom: 10px; }

        button { width: 100%; padding: 14px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-bottom: 10px; }
        #launchBtn { background: var(--accent); color: #fff; }
        #launchBtn:hover { background: #e67e22; transform: translateY(-2px); }
        #resetBtn { background: #30363d; color: white; }
    </style>
</head>
<body>

    <h1>Rocket Escape Simulator (V2.0)</h1>

    <div class="main-layout">
        <div class="panel">
            <div class="control-group">
                <label>Planet Mass: <b id="mVal">5000</b> $10^{21}$ kg</label>
                <input type="range" id="mass" min="1000" max="20000" value="5000">
            </div>
            <div class="control-group">
                <label>Planet Radius: <b id="rVal">50</b> km</label>
                <input type="range" id="radius" min="20" max="120" value="50">
            </div>
            <div class="control-group">
                <label>Launch Velocity ($v_0$): <b id="vVal">12</b> km/s</label>
                <input type="range" id="velocity" min="1" max="30" step="0.5" value="12">
            </div>

            <div class="eco-box">
                <p>Esc. Velocity ($v_e$): <span id="evDisplay" style="color:var(--accent)">0.0</span> km/s</p>
                <p>Fuel Required: <span id="fuelDisplay">0</span> kg</p>
                <p>Mission Cost:</p>
                <p id="costDisplay" class="price-tag">₹0.00</p>
            </div>
            <br>
            <button id="launchBtn">VERTICAL INITIATION</button>
            <button id="resetBtn">RESET MISSION</button>
        </div>

        <div class="panel" style="padding:10px;">
            <canvas id="simCanvas"></canvas>
            <p style="text-align:center; font-size:0.8rem; color:#666;">Vertical Launch: Velocity vector is set to $-Y$ axis</p>
        </div>

        <div class="panel">
            <h3 style="margin-top:0; font-size:1rem; color:var(--accent);">Flight Telemetry</h3>
            <div class="graph-container"><canvas id="velGraph"></canvas></div>
            <div class="graph-container"><canvas id="altGraph"></canvas></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const massInp = document.getElementById('mass');
        const radInp = document.getElementById('radius');
        const velInp = document.getElementById('velocity');

        const G = 0.1; 
        const FUEL_PRICE_PER_KG = 225.00; 
        const PROJECTILE_DRY_MASS = 100; 

        let planet = { x: 0, y: 0, mass: 5000, radius: 50 };
        let projectile = { x: 0, y: 0, vx: 0, vy: 0, active: false };
        let animationId;

        const chartOptions = {
            responsive: true, maintainAspectRatio: false,
            scales: { x: { display: false }, y: { ticks: { color: '#888' }, grid: { color: '#222' } } },
            plugins: { legend: { display: false } }, animation: false
        };

        const velChart = new Chart(document.getElementById('velGraph'), {
            type: 'line',
            data: { labels: [], datasets: [{ data: [], borderColor: '#ff9933', borderWidth: 2, pointRadius: 0, fill: true, backgroundColor: 'rgba(255, 153, 51, 0.1)' }] },
            options: { ...chartOptions, plugins: { title: { display: true, text: 'Velocity (km/s)', color: '#eee' } } }
        });

        const altChart = new Chart(document.getElementById('altGraph'), {
            type: 'line',
            data: { labels: [], datasets: [{ data: [], borderColor: '#2ecc71', borderWidth: 2, pointRadius: 0, fill: true, backgroundColor: 'rgba(46, 204, 113, 0.1)' }] },
            options: { ...chartOptions, plugins: { title: { display: true, text: 'Altitude (km)', color: '#eee' } } }
        });

        function updateEconomics() {
            const v0 = parseFloat(velInp.value);
            const ve = Math.sqrt((2 * G * planet.mass) / planet.radius);
            const fuelKg = PROJECTILE_DRY_MASS * (Math.exp(v0 / 12) - 1);
            const costINR = fuelKg * FUEL_PRICE_PER_KG;

            document.getElementById('mVal').innerText = massInp.value;
            document.getElementById('rVal').innerText = radInp.value;
            document.getElementById('vVal').innerText = v0;
            document.getElementById('evDisplay').innerText = ve.toFixed(2);
            document.getElementById('fuelDisplay').innerText = Math.round(fuelKg).toLocaleString('en-IN');
            document.getElementById('costDisplay').innerText = "₹" + costINR.toLocaleString('en-IN', { maximumFractionDigits: 0 });
            
            planet.mass = parseFloat(massInp.value);
            planet.radius = parseFloat(radInp.value);
            if(!projectile.active) draw();
        }

        function draw() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            planet.x = canvas.width / 2;
            planet.y = canvas.height / 2;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Planet
            ctx.beginPath();
            ctx.arc(planet.x, planet.y, planet.radius, 0, Math.PI * 2);
            ctx.fillStyle = '#130f40';
            ctx.fill();
            ctx.strokeStyle = '#4cc9f0';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Projectile
            if (projectile.active) {
                ctx.beginPath();
                ctx.arc(projectile.x, projectile.y, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#ff9933';
                ctx.fill();
            } else {
                // Preview at North Pole
                ctx.beginPath();
                ctx.arc(planet.x, planet.y - planet.radius - 5, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#ff9933';
                ctx.fill();
            }
        }

        function launch() {
            if (projectile.active) return;
            resetCharts();
            // STARTING POSITION: Top of the planet
            projectile.x = planet.x;
            projectile.y = planet.y - planet.radius - 5;
            // VELOCITY: Upwards (negative Y)
            projectile.vx = 0;
            projectile.vy = -parseFloat(velInp.value);
            projectile.active = true;
            animate();
        }

        function animate() {
            if (!projectile.active) return;
            const dx = planet.x - projectile.x;
            const dy = planet.y - projectile.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const force = (G * planet.mass) / (dist * dist);
            projectile.vx += (dx / dist) * force;
            projectile.vy += (dy / dist) * force;
            projectile.x += projectile.vx;
            projectile.y += projectile.vy;

            const currentVel = Math.sqrt(projectile.vx**2 + projectile.vy**2);
            const altitude = dist - planet.radius;
            updateCharts(currentVel, altitude);

            if (dist < planet.radius || dist > 4000) {
                projectile.active = false;
                cancelAnimationFrame(animationId);
            }
            draw();
            animationId = requestAnimationFrame(animate);
        }

        function updateCharts(v, a) {
            velChart.data.labels.push("");
            velChart.data.datasets[0].data.push(v);
            altChart.data.labels.push("");
            altChart.data.datasets[0].data.push(a);
            if(velChart.data.labels.length > 60) {
                velChart.data.labels.shift(); velChart.data.datasets[0].data.shift();
                altChart.data.labels.shift(); altChart.data.datasets[0].data.shift();
            }
            velChart.update(); altChart.update();
        }

        function resetCharts() {
            velChart.data.labels = []; velChart.data.datasets[0].data = [];
            altChart.data.labels = []; altChart.data.datasets[0].data = [];
            velChart.update(); altChart.update();
        }

        [massInp, radInp, velInp].forEach(el => el.addEventListener('input', updateEconomics));
        document.getElementById('launchBtn').addEventListener('click', launch);
        document.getElementById('resetBtn').addEventListener('click', () => {
            projectile.active = false;
            resetCharts();
            updateEconomics();
        });
        window.onload = updateEconomics;
    </script>
</body>
</html>
